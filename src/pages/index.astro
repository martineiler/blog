---
import { getCollection } from 'astro:content';
import readingTime from 'reading-time';
import Base from '../layouts/Base.astro';
import ArticleFeatured from '../components/ArticleFeatured.astro';
import ArticleCard from '../components/ArticleCard.astro';

const articles = await getCollection('blog', ({ data }) =>
  import.meta.env.PROD ? !data.draft : true
);

articles.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const [featured, ...rest] = articles;

const websiteJsonLd = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Eiler.dk',
  url: 'https://eiler.dk',
  description: 'Writing on technology, enterprise AI and the architecture of what comes next.',
  author: {
    '@type': 'Person',
    name: 'Martin Eiler',
    url: 'https://eiler.dk/about',
  },
};
---

<Base
  title="Eiler.dk"
  description="Writing on technology, enterprise AI and the architecture of what comes next."
  jsonLd={websiteJsonLd}
>
  <!-- Featured article -->
  {featured && (
    <ArticleFeatured
      title={featured.data.title}
      description={featured.data.description}
      date={featured.data.date}
      tags={featured.data.tags}
      slug={featured.slug}
      readingTime={readingTime(featured.body ?? '').text}
    />
  )}

  <!-- Article grid -->
  {rest.length > 0 && (
    <div class="mt-0">
      {Array.from({ length: Math.ceil(rest.length / 2) }, (_, rowIndex) => {
        const left = rest[rowIndex * 2];
        const right = rest[rowIndex * 2 + 1];
        return (
          <div class="border-b border-[#e0e0e0] grid grid-cols-1 md:grid-cols-2">
            <div class="md:border-r border-[#e0e0e0] md:pr-8">
              <ArticleCard
                title={left.data.title}
                description={left.data.description}
                date={left.data.date}
                tags={left.data.tags}
                slug={left.slug}
                readingTime={readingTime(left.body ?? '').text}
              />
            </div>
            <div class="md:pl-8">
              {right && (
                <ArticleCard
                  title={right.data.title}
                  description={right.data.description}
                  date={right.data.date}
                  tags={right.data.tags}
                  slug={right.slug}
                  readingTime={readingTime(right.body ?? '').text}
                />
              )}
            </div>
          </div>
        );
      })}
    </div>
  )}
</Base>
